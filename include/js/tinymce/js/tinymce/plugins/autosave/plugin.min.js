!function(){var l=function(a){var b=a;return{get:function(){return b},set:function(a){b=a},clone:function(){return l(b)}}},v=tinymce.util.Tools.resolve("tinymce.PluginManager"),e=tinymce.util.Tools.resolve("tinymce.util.LocalStorage"),m=tinymce.util.Tools.resolve("tinymce.util.Tools"),n=function(a,b){return((a=/^(\d+)([ms]?)$/.exec(""+(a||b)))[2]?{s:1E3,m:6E4}[a[2]]:1)*parseInt(a,10)},g=function(a){return a.getParam("autosave_prefix","tinymce-autosave-{path}{query}{hash}-{id}-").replace(/\{path\}/g,
document.location.pathname).replace(/\{query\}/g,document.location.search).replace(/\{hash\}/g,document.location.hash).replace(/\{id\}/g,a.id)},p=function(a,b){var c=a.settings.forced_root_block;return""===(b=m.trim(void 0===b?a.getBody().innerHTML:b))||(new RegExp("^<"+c+"[^>]*>((\u00a0|&nbsp;|[ \t]|<br[^>]*>)+?|)</"+c+">|<br>$","i")).test(b)},q=function(a){var b=parseInt(e.getItem(g(a)+"time"),10)||0;return!((new Date).getTime()-b>n(a.settings.autosave_retention,"20m")&&(h(a,!1),1))},h=function(a,
b){var c=g(a);e.removeItem(c+"draft");e.removeItem(c+"time");!1!==b&&a.fire("RemoveDraft")},r=function(a){var b=g(a);!p(a)&&a.isDirty()&&(e.setItem(b+"draft",a.getContent({format:"raw",no_events:!0})),e.setItem(b+"time",(new Date).getTime().toString()),a.fire("StoreDraft"))},t=function(a){var b=g(a);q(a)&&(a.setContent(e.getItem(b+"draft"),{format:"raw"}),a.fire("RestoreDraft"))},d={isEmpty:p,hasDraft:q,removeDraft:h,storeDraft:r,restoreDraft:t,startStoreDraft:function(a,b){var c=n(a.settings.autosave_interval,
"30s");b.get()||(setInterval(function(){a.removed||r(a)},c),b.set(!0))},restoreLastDraft:function(a){a.undoManager.transact(function(){t(a);h(a)});a.focus()}},f=function(a,b){return function(){var c=Array.prototype.slice.call(arguments);return a.apply(null,[b].concat(c))}},k=tinymce.util.Tools.resolve("tinymce.EditorManager");k._beforeUnloadHandler=function(){var a;return m.each(k.get(),function(b){b.plugins.autosave&&b.plugins.autosave.storeDraft();!a&&b.isDirty()&&b.getParam("autosave_ask_before_unload",
!0)&&(a=b.translate("You have unsaved changes are you sure you want to navigate away?"))}),a};var u=function(a,b){return function(c){var e=c.control;e.disabled(!d.hasDraft(a));a.on("StoreDraft RestoreDraft RemoveDraft",function(){e.disabled(!d.hasDraft(a))});d.startStoreDraft(a,b)}},w=function(a,b){a.addButton("restoredraft",{title:"Restore last draft",onclick:function(){d.restoreLastDraft(a)},onPostRender:u(a,b)});a.addMenuItem("restoredraft",{text:"Restore last draft",onclick:function(){d.restoreLastDraft(a)},
onPostRender:u(a,b),context:"file"})};v.add("autosave",function(a){var b=l(!1);window.onbeforeunload=k._beforeUnloadHandler;w(a,b);return{hasDraft:f(d.hasDraft,a),storeDraft:f(d.storeDraft,a),restoreDraft:f(d.restoreDraft,a),removeDraft:f(d.removeDraft,a),isEmpty:f(d.isEmpty,a)}})}();
