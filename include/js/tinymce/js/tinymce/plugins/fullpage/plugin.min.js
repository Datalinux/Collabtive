!function(){var m=function(b){var a=b;return{get:function(){return a},set:function(b){a=b},clone:function(){return m(a)}}},y=tinymce.util.Tools.resolve("tinymce.PluginManager"),h=tinymce.util.Tools.resolve("tinymce.util.Tools"),z=tinymce.util.Tools.resolve("tinymce.html.DomParser"),k=tinymce.util.Tools.resolve("tinymce.html.Node"),A=tinymce.util.Tools.resolve("tinymce.html.Serializer"),u=function(b){return b.getParam("fullpage_hide_in_source_view")},v=function(b){return b.getParam("fullpage_default_font_family")},
r=function(b){return z({validate:!1,root_name:"#document"}).parse(b)},B=function(b,a){var e,f;a=r(a);var d={};return d.fontface=v(b),d.fontsize=b.getParam("fullpage_default_font_size"),7===(e=a.firstChild).type&&(d.xml_pi=!0,(f=/encoding="([^"]+)"/.exec(e.value))&&(d.docencoding=f[1])),(e=a.getAll("#doctype")[0])&&(d.doctype="<!DOCTYPE"+e.value+">"),(e=a.getAll("title")[0])&&e.firstChild&&(d.title=e.firstChild.value),h.each(a.getAll("meta"),function(a){var b,c=a.attr("name"),e=a.attr("http-equiv");
c?d[c.toLowerCase()]=a.attr("content"):"Content-Type"===e&&(b=/charset\s*=\s*(.*)\s*/gi.exec(a.attr("content")))&&(d.docencoding=b[1])}),(e=a.getAll("html")[0])&&(d.langcode=e.attr("lang")||""||e.attr("xml:lang")||""),d.stylesheets=[],h.each(a.getAll("link"),function(a){"stylesheet"===a.attr("rel")&&d.stylesheets.push(a.attr("href"))}),(e=a.getAll("body")[0])&&(d.langdir=e.attr("dir")||"",d.style=e.attr("style")||"",d.visited_color=e.attr("vlink")||"",d.link_color=e.attr("link")||"",d.active_color=
e.attr("alink")||""),d},D=function(b,a,e){function f(a){g.firstChild?g.insert(a,g.firstChild):g.append(a)}var d,g,w,c,t,C=b.dom;d=r(e);(g=d.getAll("head")[0])||(c=d.getAll("html")[0],g=new k("head",1),c.firstChild?c.insert(g,c.firstChild,!0):c.append(g));c=d.firstChild;a.xml_pi?(t='version="1.0"',a.docencoding&&(t+=' encoding="'+a.docencoding+'"'),7!==c.type&&(c=new k("xml",7),d.insert(c,d.firstChild,!0)),c.value=t):c&&7===c.type&&c.remove();c=d.getAll("#doctype")[0];a.doctype?(c||(c=new k("#doctype",
10),a.xml_pi?d.insert(c,d.firstChild):f(c)),c.value=a.doctype.substring(9,a.doctype.length-1)):c&&c.remove();c=null;h.each(d.getAll("meta"),function(a){"Content-Type"===a.attr("http-equiv")&&(c=a)});a.docencoding?(c||((c=new k("meta",1)).attr("http-equiv","Content-Type"),c.shortEnded=!0,f(c)),c.attr("content","text/html; charset="+a.docencoding)):c&&c.remove();c=d.getAll("title")[0];a.title?(c?c.empty():f(c=new k("title",1)),c.append(new k("#text",3)).value=a.title):c&&c.remove();h.each(["keywords",
"description","author","copyright","robots"],function(b){var e,g,h=d.getAll("meta"),l=a[b];for(e=0;e<h.length;e++)if((g=h[e]).attr("name")===b)return void(l?g.attr("content",l):g.remove());l&&((c=new k("meta",1)).attr("name",b),c.attr("content",l),c.shortEnded=!0,f(c))});var q={};h.each(d.getAll("link"),function(a){"stylesheet"===a.attr("rel")&&(q[a.attr("href")]=a)});h.each(a.stylesheets,function(a){q[a]||((c=new k("link",1)).attr({rel:"stylesheet",text:"text/css",href:a}),c.shortEnded=!0,f(c));
delete q[a]});h.each(q,function(a){a.remove()});if(c=d.getAll("body")[0])c.attr("dir",a.langdir||void 0),c.attr("style",a.style||void 0),c.attr("vlink",a.visited_color||void 0),c.attr("link",a.link_color||void 0),c.attr("alink",a.active_color||void 0),C.setAttribs(b.getBody(),{style:a.style,dir:a.dir,vLink:a.visited_color,link:a.link_color,aLink:a.active_color});if(c=d.getAll("html")[0])c.attr("lang",a.langcode||void 0),c.attr("xml:lang",a.langcode||void 0);return g.firstChild||g.remove(),(w=A({validate:!1,
indent:!0,apply_source_formatting:!0,indent_before:"head,html,body,meta,title,script,link,style",indent_after:"head,html,body,meta,title,script,link,style"}).serialize(d)).substring(0,w.indexOf("</body>"))},E=function(b,a){var e=B(b,a.get());b.windowManager.open({title:"Document properties",data:e,defaults:{type:"textbox",size:40},body:[{name:"title",label:"Title"},{name:"keywords",label:"Keywords"},{name:"description",label:"Description"},{name:"robots",label:"Robots"},{name:"author",label:"Author"},
{name:"docencoding",label:"Encoding"}],onSubmit:function(f){f=D(b,h.extend(e,f.data),a.get());a.set(f)}})},F=function(b,a){b.addCommand("mceFullPageProperties",function(){E(b,a)})},G=function(b,a){return h.each(b,function(b){a=a.replace(b,function(a){return"\x3c!--mce:protected "+escape(a)+"--\x3e"})}),a},H=function(b){return b.replace(/\x3c!--mce:protected ([\s\S]*?)--\x3e/g,function(a,b){return unescape(b)})},I=h.each,x=function(b){return b.replace(/<\/?[A-Z]+/g,function(a){return a.toLowerCase()})},
J=function(b){var a,e="",f="";if(b.getParam("fullpage_default_xml_pi"))var d=b.getParam("fullpage_default_encoding"),e=e+('<?xml version="1.0" encoding="'+(d||"ISO-8859-1")+'" ?>\n');return e+=b.getParam("fullpage_default_doctype","<!DOCTYPE html>"),e+="\n<html>\n<head>\n",(a=b.getParam("fullpage_default_title"))&&(e+="<title>"+a+"</title>\n"),(a=b.getParam("fullpage_default_encoding"))&&(e+='<meta http-equiv="Content-Type" content="text/html; charset='+a+'" />\n'),(a=v(b))&&(f+="font-family: "+a+
";"),(a=b.getParam("fullpage_default_font_size"))&&(f+="font-size: "+a+";"),(a=b.getParam("fullpage_default_text_color"))&&(f+="color: "+a+";"),e+("</head>\n<body"+(f?' style="'+f+'"':"")+">\n")},K=function(b,a,e){b.on("BeforeSetContent",function(f){!function(a,b,e,c){var d,f,g,l,k="",n=a.dom;if(!(c.selection||(g=G(a.settings.protect,c.content),"raw"===c.format&&b.get()||c.source_view&&u(a)))){0!==g.length||c.source_view||(g=h.trim(b.get())+"\n"+h.trim(g)+"\n"+h.trim(e.get()));-1!==(d=(g=g.replace(/<(\/?)BODY/gi,
"<$1body")).indexOf("<body"))?(d=g.indexOf(">",d),b.set(x(g.substring(0,d+1))),-1===(f=g.indexOf("</body",d))&&(f=g.length),c.content=h.trim(g.substring(d+1,f)),e.set(x(g.substring(f)))):(b.set(J(a)),e.set("\n</body>\n</html>"));b=r(b.get());I(b.getAll("style"),function(a){a.firstChild&&(k+=a.firstChild.value)});(l=b.getAll("body")[0])&&n.setAttribs(a.getBody(),{style:l.attr("style")||"",dir:l.attr("dir")||"",vLink:l.attr("vlink")||"",link:l.attr("link")||"",aLink:l.attr("alink")||""});n.remove("fullpage_styles");
var m=a.getDoc().getElementsByTagName("head")[0];k&&(n.add(m,"style",{id:"fullpage_styles"},k),(l=n.get("fullpage_styles")).styleSheet&&(l.styleSheet.cssText=k));var p={};h.each(m.getElementsByTagName("link"),function(a){"stylesheet"===a.rel&&a.getAttribute("data-mce-fullpage")&&(p[a.href]=a)});h.each(b.getAll("link"),function(a){var b=a.attr("href");if(!b)return!0;p[b]||"stylesheet"!==a.attr("rel")||n.add(m,"link",{rel:"stylesheet",text:"text/css",href:b,"data-mce-fullpage":"1"});delete p[b]});h.each(p,
function(a){a.parentNode.removeChild(a)})}}(b,a,e,f)});b.on("GetContent",function(f){var d,g;d=a.get();g=e.get();f.selection||f.source_view&&u(b)||(f.content=H(h.trim(d)+"\n"+h.trim(f.content)+"\n"+h.trim(g)))})};y.add("fullpage",function(b){var a=m(""),e=m("");F(b,a);b.addButton("fullpage",{title:"Document properties",cmd:"mceFullPageProperties"});b.addMenuItem("fullpage",{text:"Document properties",cmd:"mceFullPageProperties",context:"file"});K(b,a,e)})}();
